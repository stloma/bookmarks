{"version":3,"sources":["../../../src/server/routes/user.js"],"names":["user","Router","get","req","res","session","destroy","logout","redirect","post","authenticate","status","json","name","newUser","body","created","Date","getTime","inputErrors","result","username","error","userDb","passport","newPassword"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;AACA;;;;;;AAEA,IAAMA,OAAO,kBAAQC,MAAR,EAAb;;AAEAD,KAAKE,GAAL,CAAS,SAAT,sBAAyC,UAACC,GAAD,EAAMC,GAAN,EAAc;AACrDD,MAAIE,OAAJ,CAAYC,OAAZ;AACAH,MAAII,MAAJ;AACAH,MAAII,QAAJ,CAAa,QAAb;AACD,CAJD;;AAMAR,KAAKS,IAAL,CAAU,QAAV,EAAoB,mBAASC,YAAT,CAAsB,OAAtB,CAApB,EAAoD,UAACP,GAAD,EAAMC,GAAN,EAAc;AAChEA,MAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,MAAMT,IAAID,GAAJ,CAAQH,IAAR,CAAaa,IAArB,EAArB;AACD,CAFD;;AAIAb,KAAKS,IAAL,CAAU,eAAV,EAA2B,gBAAON,GAAP,EAAYC,GAAZ,EAAoB;AAC7C,MAAMU,UAAUX,IAAIY,IAApB;AACAD,UAAQE,OAAR,GAAkB,IAAIC,IAAJ,GAAWC,OAAX,EAAlB;;AAEA,MAAMC,cAAc,gCAAqBL,OAArB,CAApB;;AAEA,MAAIK,WAAJ,EAAiB;AAAEf,QAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBO,WAArB;AAAmC;;AAEtD,MAAI;AACF,QAAMC,SAAS,MAAM,sBAAWN,OAAX,CAArB;AACA,QAAIM,WAAW,KAAf,EAAsB;AACpBhB,UAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,CAAIE,QAAQO,QAAZ,mDAArB;AACD,KAFD,MAEO;AACLjB,UAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,8BAAgDQ,OAAOC,QAAvD;AACD;AACF,GAPD,CAOE,OAAOC,KAAP,EAAc;AACdlB,QAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,6BAA+CU,KAA/C;AACD;AACF,CAlBD;;AAoBAtB,KAAKS,IAAL,CAAU,iBAAV,sBAAkD,gBAAON,GAAP,EAAYC,GAAZ,EAAoB;AACpE,MAAMmB,SAASpB,IAAIE,OAAJ,CAAYmB,QAAZ,CAAqBxB,IAApC;AACA,MAAMyB,cAActB,IAAIY,IAAxB;;AAEA;;AAEA;;AAEA,MAAI;AACF,UAAM,0BAAeQ,MAAf,EAAuBE,WAAvB,CAAN;AACArB,QAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,+BAArB;AACD,GAHD,CAGE,OAAOU,KAAP,EAAc;AACdlB,QAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,6BAA+CU,KAA/C;AACD;AACF,CAdD;;kBAgBetB,I","file":"user.js","sourcesContent":["import express from 'express'\nimport passport from 'passport'\n\nimport { CreateUser, ChangePassword, validateRegistration } from '../models/user'\nimport ensureAuthenticated from '../auth/passport'\n\nconst user = express.Router()\n\nuser.get('/logout', ensureAuthenticated, (req, res) => {\n  req.session.destroy()\n  req.logout()\n  res.redirect('/login')\n})\n\nuser.post('/login', passport.authenticate('local'), (req, res) => {\n  res.status(200).json({ name: res.req.user.name })\n})\n\nuser.post('/registeruser', async (req, res) => {\n  const newUser = req.body\n  newUser.created = new Date().getTime()\n\n  const inputErrors = validateRegistration(newUser)\n\n  if (inputErrors) { res.status(400).json(inputErrors) }\n\n  try {\n    const result = await CreateUser(newUser)\n    if (result === 11000) {\n      res.status(409).json([`${newUser.username} already registered, please try another name.`])\n    } else {\n      res.status(200).json(`Successfully registered ${result.username}`)\n    }\n  } catch (error) {\n    res.status(500).json(`Internal Server Error: ${error}`)\n  }\n})\n\nuser.post('/changepassword', ensureAuthenticated, async (req, res) => {\n  const userDb = req.session.passport.user\n  const newPassword = req.body\n\n  // const inputErrors = validateRegistration(newUser)\n\n  // if (inputErrors) { res.status(400).json(inputErrors) }\n\n  try {\n    await ChangePassword(userDb, newPassword)\n    res.status(200).json('Password changed successfully')\n  } catch (error) {\n    res.status(500).json(`Internal Server Error: ${error}`)\n  }\n})\n\nexport default user\n"]}